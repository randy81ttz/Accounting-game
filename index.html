<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ë‹¨ì–´ í•™ìŠµ & í€´ì¦ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Gasoek+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .font-title {
            font-family: 'Gasoek One', sans-serif;
        }
        .main-container {
            max-width: 420px; /* ëª¨ë°”ì¼ í™”ë©´ì— ìµœì í™”ëœ ë„ˆë¹„ */
        }
        .card {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card .front, .card .back {
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        .card .back {
            transform: rotateY(180deg);
        }
        .card.is-flipped {
            transform: rotateY(180deg);
        }
        .btn:active {
            transform: scale(0.96);
        }
        .quiz-option.correct {
            background-color: #2ecc71 !important;
            color: white !important;
            border-color: #27ae60 !important;
        }
        .quiz-option.incorrect {
            background-color: #e74c3c !important;
            color: white !important;
            border-color: #c0392b !important;
        }
        .quiz-option.disabled {
            pointer-events: none;
            opacity: 0.7;
        }
    </style>
</head>
<body class="bg-sky-50 flex items-center justify-center min-h-screen p-4">

    <div class="main-container w-full mx-auto">

        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="start-screen" class="text-center bg-white p-8 rounded-2xl shadow-xl">
            <h1 class="text-4xl font-title text-sky-600 mb-4">ì˜ë‹¨ì–´ ì •ë³µ!</h1>
            <p class="text-gray-600 mb-8">í•™ìŠµê³¼ í€´ì¦ˆ ì¤‘ ë¬´ì—‡ì„ ë¨¼ì € í•´ë³¼ê¹Œ?</p>
            <div class="space-y-4">
                <button id="start-study-btn" class="btn w-full bg-amber-400 hover:bg-amber-500 text-white font-bold py-4 px-4 rounded-xl text-2xl shadow-md transition-transform">
                    ğŸ“– í•™ìŠµí•˜ê¸°
                </button>
                <button id="start-quiz-btn" class="btn w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-4 px-4 rounded-xl text-2xl shadow-md transition-transform">
                    âœï¸ í€´ì¦ˆ í’€ê¸°
                </button>
            </div>
        </div>

        <!-- í•™ìŠµ ëª¨ë“œ í™”ë©´ -->
        <div id="study-screen" class="hidden">
            <div class="relative">
                <div id="study-card" class="card w-full h-80">
                    <!-- ì¹´ë“œ ì•ë©´ -->
                    <div class="front absolute w-full h-full bg-white rounded-2xl shadow-lg p-8 flex flex-col justify-center items-center">
                        <p id="study-word" class="text-6xl font-bold text-sky-700"></p>
                        <button id="speak-btn-front" class="mt-4 text-4xl">ğŸ”Š</button>
                        <button id="flip-to-back-btn" class="mt-8 w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl text-lg">ì •ë‹µ í™•ì¸</button>
                    </div>
                    <!-- ì¹´ë“œ ë’·ë©´ -->
                    <div class="back absolute w-full h-full bg-sky-100 rounded-2xl shadow-lg p-8 flex flex-col justify-center items-center text-center">
                        <p id="study-meaning" class="text-4xl font-bold text-sky-800 mb-4"></p>
                        <p id="study-example" class="text-lg text-gray-700"></p>
                        <button id="flip-to-front-btn" class="mt-8 w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl text-lg">ë‹¤ì‹œ ë³´ê¸°</button>
                    </div>
                </div>
            </div>
            <div class="flex justify-between mt-6">
                <button id="prev-word-btn" class="btn bg-white py-3 px-6 rounded-lg shadow-md font-bold text-gray-700">ì´ì „</button>
                <p id="study-progress" class="flex items-center font-semibold text-gray-600">1 / 12</p>
                <button id="next-word-btn" class="btn bg-white py-3 px-6 rounded-lg shadow-md font-bold text-gray-700">ë‹¤ìŒ</button>
            </div>
            <button id="back-to-start-from-study" class="btn w-full mt-6 bg-red-400 hover:bg-red-500 text-white font-bold py-3 rounded-xl text-lg">ì²˜ìŒìœ¼ë¡œ</button>
        </div>

        <!-- í€´ì¦ˆ ëª¨ë“œ í™”ë©´ -->
        <div id="quiz-screen" class="hidden">
             <div class="text-center mb-4">
                <p id="quiz-progress-text" class="text-lg font-semibold text-gray-700">ë¬¸ì œ 1 / 12</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                    <div id="quiz-progress-bar" class="bg-amber-400 h-2.5 rounded-full transition-all duration-300" style="width: 8%"></div>
                </div>
            </div>
            <div class="bg-white p-8 rounded-2xl shadow-lg text-center mb-6">
                <p id="quiz-word" class="text-5xl font-bold text-sky-700"></p>
                 <button id="speak-btn-quiz" class="mt-2 text-3xl">ğŸ”Š</button>
            </div>
            <div id="quiz-options" class="grid grid-cols-1 gap-3">
                <!-- ë³´ê¸° ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
            <button id="back-to-start-from-quiz" class="btn w-full mt-6 bg-red-400 hover:bg-red-500 text-white font-bold py-3 rounded-xl text-lg">ì²˜ìŒìœ¼ë¡œ</button>
        </div>
        
        <!-- ê²°ê³¼ í™”ë©´ -->
        <div id="result-screen" class="hidden text-center bg-white p-8 rounded-2xl shadow-xl">
            <h2 class="text-3xl font-bold text-sky-600 mb-2">ì°¸ ì˜í–ˆì–´ìš”!</h2>
            <p id="score-text" class="text-2xl text-gray-700 mb-6"></p>
            <div id="result-message" class="text-xl text-amber-600 font-semibold mb-8"></div>
            <button id="retry-quiz-btn" class="btn w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-4 px-4 rounded-xl text-2xl shadow-md">
                ë‹¤ì‹œ í’€ì–´ë³´ê¸°
            </button>
             <button id="back-to-start-from-result" class="btn w-full mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 rounded-xl text-lg">ì²˜ìŒìœ¼ë¡œ</button>
        </div>

    </div>

    <script>
        const words = [
            { word: 'beach', meaning: 'í•´ë³€', example: "Let's go to the beach." },
            { word: 'sea', meaning: 'ë°”ë‹¤', example: 'There are lots of fish under the sea.' },
            { word: 'park', meaning: 'ê³µì›', example: 'Many people go to the park.' },
            { word: 'bird', meaning: 'ìƒˆ', example: 'The birds make a nest on the tree.' },
            { word: 'sing', meaning: 'ë…¸ë˜í•˜ë‹¤', example: 'Can Jenny sing well?' },
            { word: 'buzz', meaning: 'ìœ™ìœ™ê±°ë¦¬ë‹¤', example: 'The bees buzz.' },
            { word: 'what', meaning: 'ë¬´ì—‡', example: 'What do you want for your birthday?' },
            { word: 'tweet', meaning: 'ì§¹ì§¹ê±°ë¦¬ë‹¤', example: 'The birds tweet.' },
            { word: 'man', meaning: 'ë‚¨ì', example: 'That man is a cook.' },
            { word: 'woof', meaning: 'ë©ë©', example: 'The dog says woof.' },
            { word: 'math', meaning: 'ìˆ˜í•™', example: "James doesn't like math." },
            { word: 'clothe', meaning: 'ì˜·ì„ ì…íˆë‹¤', example: 'Parents clothe their children everyday.' }
        ];

        // UI ìš”ì†Œ
        const startScreen = document.getElementById('start-screen');
        const studyScreen = document.getElementById('study-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');

        // ë²„íŠ¼
        const startStudyBtn = document.getElementById('start-study-btn');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const backToStartFromStudy = document.getElementById('back-to-start-from-study');
        const backToStartFromQuiz = document.getElementById('back-to-start-from-quiz');
        const backToStartFromResult = document.getElementById('back-to-start-from-result');
        const retryQuizBtn = document.getElementById('retry-quiz-btn');

        // ìƒíƒœ ë³€ìˆ˜
        let currentWordIndex = 0;
        let currentQuizIndex = 0;
        let quizQuestions = [];
        let score = 0;
        const synth = window.speechSynthesis;
        let voices = [];

        // --- ìŒì„± í•©ì„± ê¸°ëŠ¥ ---
        function populateVoiceList() {
            if(typeof synth === 'undefined') {
                return;
            }
            voices = synth.getVoices().filter(voice => voice.lang.startsWith('en'));
        }

        populateVoiceList();
        if (typeof synth !== 'undefined' && synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = populateVoiceList;
        }

        function speak(text) {
            if (synth.speaking) {
                console.error('speechSynthesis.speaking');
                return;
            }
            if (text !== '') {
                const utterThis = new SpeechSynthesisUtterance(text);
                utterThis.onend = function (event) {
                    // console.log('SpeechSynthesisUtterance.onend');
                }
                utterThis.onerror = function (event) {
                    console.error('SpeechSynthesisUtterance.onerror');
                }
                // ì˜ì–´ ëª©ì†Œë¦¬ ìš°ì„  ì„ íƒ
                const englishVoice = voices.find(voice => voice.name.includes('Google US English') || voice.name.includes('Microsoft David') || voice.lang === 'en-US');
                utterThis.voice = englishVoice || voices[0];
                utterThis.pitch = 1;
                utterThis.rate = 0.9;
                synth.speak(utterThis);
            }
        }

        // --- í™”ë©´ ì „í™˜ ë¡œì§ ---
        function showScreen(screen) {
            startScreen.classList.add('hidden');
            studyScreen.classList.add('hidden');
            quizScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            screen.classList.remove('hidden');
        }

        startStudyBtn.addEventListener('click', () => {
            showScreen(studyScreen);
            startStudy();
        });
        startQuizBtn.addEventListener('click', () => {
            showScreen(quizScreen);
            startQuiz();
        });
        backToStartFromStudy.addEventListener('click', () => showScreen(startScreen));
        backToStartFromQuiz.addEventListener('click', () => showScreen(startScreen));
        backToStartFromResult.addEventListener('click', () => showScreen(startScreen));
        retryQuizBtn.addEventListener('click', () => {
            showScreen(quizScreen);
            startQuiz();
        });

        // --- í•™ìŠµ ëª¨ë“œ ë¡œì§ ---
        const studyCard = document.getElementById('study-card');
        const studyWord = document.getElementById('study-word');
        const studyMeaning = document.getElementById('study-meaning');
        const studyExample = document.getElementById('study-example');
        const studyProgress = document.getElementById('study-progress');
        const speakBtnFront = document.getElementById('speak-btn-front');
        const flipToBackBtn = document.getElementById('flip-to-back-btn');
        const flipToFrontBtn = document.getElementById('flip-to-front-btn');
        const prevWordBtn = document.getElementById('prev-word-btn');
        const nextWordBtn = document.getElementById('next-word-btn');
        
        function startStudy() {
            currentWordIndex = 0;
            displayStudyWord();
        }

        function displayStudyWord() {
            studyCard.classList.remove('is-flipped');
            const wordData = words[currentWordIndex];
            studyWord.textContent = wordData.word;
            studyMeaning.textContent = wordData.meaning;
            studyExample.textContent = wordData.example;
            studyProgress.textContent = `${currentWordIndex + 1} / ${words.length}`;
        }

        speakBtnFront.addEventListener('click', () => speak(words[currentWordIndex].word));
        flipToBackBtn.addEventListener('click', () => studyCard.classList.add('is-flipped'));
        flipToFrontBtn.addEventListener('click', () => studyCard.classList.remove('is-flipped'));
        
        nextWordBtn.addEventListener('click', () => {
            currentWordIndex = (currentWordIndex + 1) % words.length;
            displayStudyWord();
        });
        prevWordBtn.addEventListener('click', () => {
            currentWordIndex = (currentWordIndex - 1 + words.length) % words.length;
            displayStudyWord();
        });

        // --- í€´ì¦ˆ ëª¨ë“œ ë¡œì§ ---
        const quizProgressText = document.getElementById('quiz-progress-text');
        const quizProgressBar = document.getElementById('quiz-progress-bar');
        const quizWord = document.getElementById('quiz-word');
        const speakBtnQuiz = document.getElementById('speak-btn-quiz');
        const quizOptions = document.getElementById('quiz-options');
        const scoreText = document.getElementById('score-text');
        const resultMessage = document.getElementById('result-message');
        
        function startQuiz() {
            currentQuizIndex = 0;
            score = 0;
            createQuizQuestions();
            displayQuizQuestion();
        }

        function createQuizQuestions() {
            quizQuestions = [...words].sort(() => Math.random() - 0.5);
        }

        function displayQuizQuestion() {
            const question = quizQuestions[currentQuizIndex];
            quizWord.textContent = question.word;
            quizOptions.innerHTML = '';
            
            // ì •ë‹µê³¼ ì˜¤ë‹µ ë³´ê¸° ë§Œë“¤ê¸°
            const options = [question.meaning];
            while (options.length < 4) {
                const randomWord = words[Math.floor(Math.random() * words.length)];
                if (!options.includes(randomWord.meaning)) {
                    options.push(randomWord.meaning);
                }
            }
            // ë³´ê¸° ì„ê¸°
            options.sort(() => Math.random() - 0.5);

            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('quiz-option', 'btn', 'w-full', 'bg-white', 'p-4', 'rounded-lg', 'shadow', 'text-lg', 'font-semibold', 'text-gray-700', 'border-2', 'border-gray-200', 'hover:bg-gray-100');
                button.addEventListener('click', () => checkAnswer(button, option, question.meaning));
                quizOptions.appendChild(button);
            });

            // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
            quizProgressText.textContent = `ë¬¸ì œ ${currentQuizIndex + 1} / ${quizQuestions.length}`;
            const progressPercentage = ((currentQuizIndex + 1) / quizQuestions.length) * 100;
            quizProgressBar.style.width = `${progressPercentage}%`;
        }

        speakBtnQuiz.addEventListener('click', () => speak(quizQuestions[currentQuizIndex].word));

        function checkAnswer(button, selectedMeaning, correctMeaning) {
            const allOptions = quizOptions.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => opt.classList.add('disabled'));

            if (selectedMeaning === correctMeaning) {
                score++;
                button.classList.add('correct');
            } else {
                button.classList.add('incorrect');
                allOptions.forEach(opt => {
                    if (opt.textContent === correctMeaning) {
                        opt.classList.add('correct');
                    }
                });
            }

            setTimeout(() => {
                currentQuizIndex++;
                if (currentQuizIndex < quizQuestions.length) {
                    displayQuizQuestion();
                } else {
                    showResults();
                }
            }, 1500);
        }

        function showResults() {
            showScreen(resultScreen);
            scoreText.textContent = `${quizQuestions.length}ê°œ ì¤‘ì— ${score}ê°œë¥¼ ë§í˜”ì–´ìš”!`;
            
            let message = '';
            const percentage = (score / quizQuestions.length) * 100;
            if (percentage === 100) {
                message = 'ì™€, ì™„ë²½í•´ìš”! ì˜ì–´ ë‹¨ì–´ ë°•ì‚¬ë‹˜ì´ë„¤ìš”! ğŸ†';
            } else if (percentage >= 70) {
                message = 'ì •ë§ ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë”í•˜ë©´ ë‹¤ ë§í ìˆ˜ ìˆê² ì–´ìš”! ğŸ‘';
            } else if (percentage >= 50) {
                message = 'ì¢‹ì•„ìš”! ìê¾¸ í•˜ë‹¤ ë³´ë©´ ì‹¤ë ¥ì´ ì‘¥ì‘¥ ëŠ˜ ê±°ì˜ˆìš”! ğŸ˜Š';
            } else {
                message = 'ê´œì°®ì•„! ë‹¤ì‹œ í•œë²ˆ ë„ì „í•´ë³¼ê¹Œìš”? í•  ìˆ˜ ìˆì–´ìš”! ğŸ’ª';
            }
            resultMessage.textContent = message;
        }
    </script>
</body>
</html>
